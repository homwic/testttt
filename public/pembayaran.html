<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pembayaran API | API Demo</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card shadow">
            <div class="card-header text-center">Langganan API</div>
            <div class="card-body">
              <h5>Harga Paket API: <b>Rp 10.000 / 30 hari</b></h5>
              <form id="payForm">
                <label>Pilih Metode Pembayaran:</label>
                <select class="form-select mb-3" id="payMethod" required>
                  <option value="">Pilih Channel...</option>
                  <option value="BCAVA">BCA VA</option>
                  <option value="BNIVA">BNI VA</option>
                  <option value="BRIVA">BRI VA</option>
                  <option value="QRIS">QRIS</option>
                </select>
                <button class="btn btn-primary w-100">Buat Invoice</button>
              </form>
              <div id="payResult" class="mt-3"></div>
              <div class="mt-4 text-center">
                <a href="dashboard.html">Kembali ke Dashboard</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      if (!localStorage.getItem("token")) location = "index.html";
      document.getElementById("payForm").onsubmit = async function (e) {
        e.preventDefault();
        const method = document.getElementById("payMethod").value;
        if (!method) return alert("Pilih channel pembayaran!");
        const resp = await fetch("/api/pay", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
          body: JSON.stringify({ method }),
        });
        const data = await resp.json();
        const payResult = document.getElementById("payResult");
        if (data.status === "ok" && data.payment_url) {
          payResult.innerHTML = `
          <div class="alert alert-success">
            Invoice berhasil dibuat!<br>
            <b>Silakan bayar melalui channel yang dipilih.</b><br>
            <a class="btn btn-success mt-2" target="_blank" href="${data.payment_url}">Bayar Sekarang</a>
          </div>
        `;
        } else if (data.status === "ok") {
          payResult.innerHTML = `<div class="alert alert-warning">Invoice berhasil dibuat tapi link pembayaran tidak tersedia. Silakan cek dashboard atau hubungi admin.</div>`;
        } else {
          payResult.innerHTML = `<div class="alert alert-danger">${
            data.message || "Gagal membuat invoice pembayaran."
          }</div>`;
        }
      };
    </script>
  </body>
</html>
